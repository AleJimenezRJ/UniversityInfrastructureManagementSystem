@page "/universidades"

@using UCR.ECCI.PI.ThemePark.Frontend.Blazor.Application.Services
@using UCR.ECCI.PI.ThemePark.Frontend.Blazor.Presentation.Models
@using UCR.ECCI.PI.ThemePark.Frontend.Blazor.Domain.Entities.UniversityManagement
@using UCR.ECCI.PI.ThemePark.Frontend.Blazor.Presentation.Components
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using MudBlazor

@attribute [Authorize]
@inject IUniversityServices UniversityRepository
@inject NavigationManager NavigationManager
@inject IPermissionContext PermissionContext

@*
    This page the list of universities in the system.
    It allows users to view details of each university and navigate to add a new university if they have the necessary permissions.
*@
<CleanBreadcrumbs />
<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-0">
    <div style="overflow-x: auto; overflow-y: auto; padding: 1rem; padding-bottom: 80px;">
            <PageTitle>Administración de Universidades</PageTitle>

       <div style="display: flex;
                        justify-content: space-between;
                        align-items: center;
                        flex-wrap: wrap;    
                        gap: 1rem;
                        width: 100%;
                        margin-bottom: 1rem;">
            <h3 class="text-h1" style="margin: 0">Administración de Universidades</h3>
            <AuthorizeView Policy="Create Universities">
                <Authorized>
                    <CustomButton ButtonType="add"
                                    Variant="Variant.Filled"
                                    OnClick="@GoToAddUniversity">
                        AGREGAR
                    </CustomButton>
                </Authorized>
             </AuthorizeView>

       </div>

            @if (isLoading)
            {
                <Spinner />
            }
            else
            {
                <div class="table-container">
                    <MudTable T="University"
                    Items=@universities
                    Hover="true"
                    Bordered="true"
                    Striped="true"
                    Elevation="1"
                    Dense="true"
                    RowsPerPage="10"
                    CustomHeader="true"
                    HeaderClass="mud-table-sticky-header"
                    Style="min-width: 650px; white-space: nowrap; table-layout: fixed;"
                    Breakpoint="Breakpoint.None">
                        <HeaderContent>
                            <MudTh><span class="text-h3 fw-bold">Universidad</span></MudTh>
                            <MudTh><span class="text-h3 fw-bold">País</span></MudTh>
                            <MudTh><span class="text-h3 fw-bold">Sedes</span></MudTh>
                            <MudTh><span class="text-h3 fw-bold">Áreas</span></MudTh>
                            <MudTh><span class="text-h3 fw-bold">Edificios</span></MudTh>
                        </HeaderContent>

                        <RowTemplate>
                            <MudTd DataLabel="Universidad" class="text-link-blue">
                                <MudLink Href="@($"/universidades/mostrar-universidad/{context.Name!.Name}")">@context.Name.Name</MudLink>
                            </MudTd>
                            <MudTd DataLabel="País" Class="text-body">@context.Country!.Location</MudTd>
                            <MudTd DataLabel="Sedes" Class="text-link-blue">
                                <MudLink Href="/sedes">Ver</MudLink>
                            </MudTd>
                            <MudTd DataLabel="Áreas" Class="text-link-blue">
                                <MudLink Href="/areas">Ver</MudLink>
                            </MudTd>
                            <MudTd DataLabel="Edificios" Class="text-link-blue">
                                <MudLink Href="/edificios">Ver</MudLink>
                            </MudTd>
                        </RowTemplate>
                   
                        <NoRecordsContent>
                        <MudText Class="text-h3"> No hay elementos para mostrar </MudText>
                    </NoRecordsContent>
                
                </MudTable>
            </div>

        }
    </div>
</MudContainer>


<style>
    .table-container {
        max-width: 100%;
        margin: 0;
        padding: 0;
    }
</style>


@code {
    /// <summary>
    /// The list of universities to display.
    /// </summary>
    private IEnumerable<University>? universities;
    private bool isLoading = true;

    /// <summary>
    /// Calls the UniversityRepository to list all universities asynchronously when the component is initialized.
    /// </summary>
    /// <returns></returns>
    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        universities = await UniversityRepository.ListUniversityAsync();
        isLoading = false;
    }

    /// <summary>
    /// Go to the page to add a new university.
    /// </summary>
    void GoToAddUniversity()
    {
        NavigationManager.NavigateTo("/universidades/agregar-universidad");
    }
}
